{{- $urlPre   := "https://api.github.com" -}}
{{- $userID   := .Get "user" | default "loikein" -}}
{{- $repoID   := .Get "repo" -}}
{{- $filePath := .Get "file" -}}
{{- $fileJSON := getJSON $urlPre "/repos/" $userID "/" $repoID "/contents/" $filePath (dict "X-GitHub-Api-Version" "2022-11-28") -}}
{{- $lang     := .Get "lang" | default "guessSyntax=true" -}}
{{- $lineNos  := .Get "lineNos" | default "false" -}}
{{- $optionLineNos := printf "%s" $lineNos | printf "%s%s" "lineNos=" | printf "%s" -}}
{{- $hlLines  := .Get "hlLines" | default "" -}}
{{- $optionHlLines := printf "%s" $hlLines | printf "%s%s" "hl_Lines=" | printf "%s" -}}
{{- /*

Note: Only files (no directories) are supported.

json dot: https://discourse.gohugo.io/t/accessing-json-data-files-with-extra-dots-in-file-names/15498/7
remote file: https://discourse.gohugo.io/t/include-content-of-a-url/27357/7
https://gohugo.io/content-management/shortcodes/#gist
https://gohugo.io/functions/highlight/#examples

GitHub API doc: https://docs.github.com/en/rest/repos/contents?apiVersion=2022-11-28

Embed GitHub: https://emgithub.com/

*/ -}}
<span class="gist__name">
<span>GitHub File: <a href="{{- printf "%s" $fileJSON.html_url -}}">{{- $userID -}}/{{- $repoID -}}/{{- $filePath -}}</a></span>
<span class="gist__name--lang">{{ $lang }}</span>
</span>
{{- $content := printf "%s" $fileJSON.content | base64Decode | htmlUnescape | safeHTML -}}
{{- $options := slice $optionLineNos $optionHlLines -}}
{{- transform.Highlight $content $lang (delimit $options ",") -}}
